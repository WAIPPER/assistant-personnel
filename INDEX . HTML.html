<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ASHA ‚Äî Votre Assistant Personnel</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0d0f14;
    --surface: #161922;
    --surface2: #1e2230;
    --border: rgba(255,255,255,0.07);
    --accent: #c9a96e;
    --accent2: #7eb8c9;
    --text: #e8e4dc;
    --muted: #7a7f8e;
    --danger: #e07070;
    --success: #70c99a;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    height: 100dvh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  /* Animated background */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background: radial-gradient(ellipse 60% 40% at 80% 20%, rgba(201,169,110,0.06) 0%, transparent 60%),
                radial-gradient(ellipse 40% 50% at 10% 80%, rgba(126,184,201,0.05) 0%, transparent 60%);
    pointer-events: none;
    z-index: 0;
  }

  /* HEADER */
  header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 24px;
    border-bottom: 1px solid var(--border);
    background: rgba(13,15,20,0.8);
    backdrop-filter: blur(12px);
    position: relative;
    z-index: 10;
    flex-shrink: 0;
  }
  .logo {
    font-family: 'Playfair Display', serif;
    font-size: 1.5rem;
    color: var(--accent);
    letter-spacing: 0.1em;
  }
  .logo span { color: var(--text); font-style: italic; font-weight: 400; font-size: 0.85rem; display: block; letter-spacing: 0.05em; }
  .status-dot { width:8px; height:8px; border-radius:50%; background: var(--success); box-shadow: 0 0 8px var(--success); animation: pulse 2s infinite; }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.5} }

  /* TABS */
  .tabs {
    display: flex;
    gap: 4px;
    padding: 12px 24px;
    border-bottom: 1px solid var(--border);
    background: var(--surface);
    position: relative;
    z-index: 9;
    flex-shrink: 0;
  }
  .tab {
    padding: 8px 16px;
    border-radius: 8px;
    border: none;
    background: transparent;
    color: var(--muted);
    font-family: 'DM Sans', sans-serif;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .tab:hover { background: var(--surface2); color: var(--text); }
  .tab.active { background: var(--surface2); color: var(--accent); border: 1px solid rgba(201,169,110,0.3); }
  .tab-icon { font-size: 1rem; }

  /* PANELS */
  .panel { display: none; flex: 1; overflow: hidden; flex-direction: column; position: relative; z-index: 1; }
  .panel.active { display: flex; }

  /* CHAT PANEL */
  .chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 24px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    scroll-behavior: smooth;
  }
  .chat-messages::-webkit-scrollbar { width: 4px; }
  .chat-messages::-webkit-scrollbar-track { background: transparent; }
  .chat-messages::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

  .message {
    display: flex;
    gap: 12px;
    animation: fadeIn 0.3s ease;
  }
  @keyframes fadeIn { from { opacity:0; transform: translateY(8px); } to { opacity:1; transform:translateY(0); } }
  .message.user { flex-direction: row-reverse; }
  .avatar {
    width: 36px; height: 36px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 1rem; flex-shrink: 0;
  }
  .avatar.asha { background: linear-gradient(135deg, #c9a96e, #a07840); }
  .avatar.user { background: var(--surface2); border: 1px solid var(--border); }
  .bubble {
    max-width: 70%;
    padding: 12px 16px;
    border-radius: 16px;
    font-size: 0.9rem;
    line-height: 1.6;
  }
  .message.asha .bubble {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-top-left-radius: 4px;
  }
  .message.user .bubble {
    background: linear-gradient(135deg, rgba(201,169,110,0.2), rgba(201,169,110,0.1));
    border: 1px solid rgba(201,169,110,0.3);
    border-top-right-radius: 4px;
  }
  .bubble .name { font-size: 0.75rem; color: var(--muted); margin-bottom: 4px; }
  .message.asha .bubble .name { color: var(--accent); }

  .typing { display: flex; gap: 4px; align-items: center; padding: 4px 0; }
  .typing span { width:6px; height:6px; border-radius:50%; background: var(--muted); animation: bounce 1.2s infinite; }
  .typing span:nth-child(2) { animation-delay: 0.2s; }
  .typing span:nth-child(3) { animation-delay: 0.4s; }
  @keyframes bounce { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-6px)} }

  .chat-input-area {
    padding: 16px 24px;
    border-top: 1px solid var(--border);
    background: rgba(13,15,20,0.8);
    backdrop-filter: blur(12px);
    flex-shrink: 0;
  }
  .chat-input-row {
    display: flex;
    gap: 10px;
    align-items: flex-end;
  }
  .chat-input {
    flex: 1;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 12px 16px;
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-size: 0.9rem;
    resize: none;
    outline: none;
    max-height: 120px;
    transition: border-color 0.2s;
  }
  .chat-input:focus { border-color: rgba(201,169,110,0.5); }
  .chat-input::placeholder { color: var(--muted); }
  .send-btn {
    width: 44px; height: 44px;
    border-radius: 12px;
    border: none;
    background: linear-gradient(135deg, var(--accent), #a07840);
    color: #0d0f14;
    cursor: pointer;
    font-size: 1.1rem;
    transition: all 0.2s;
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
  }
  .send-btn:hover { transform: scale(1.05); opacity: 0.9; }
  .send-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

  /* TASKS PANEL */
  .panel-content {
    flex: 1;
    overflow-y: auto;
    padding: 24px;
  }
  .panel-content::-webkit-scrollbar { width: 4px; }
  .panel-content::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

  .panel-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
  }
  .panel-title {
    font-family: 'Playfair Display', serif;
    font-size: 1.3rem;
    color: var(--text);
  }
  .add-btn {
    padding: 8px 16px;
    background: transparent;
    border: 1px solid rgba(201,169,110,0.4);
    color: var(--accent);
    border-radius: 8px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s;
  }
  .add-btn:hover { background: rgba(201,169,110,0.1); }

  .task-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 14px 16px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    margin-bottom: 8px;
    transition: all 0.2s;
    animation: fadeIn 0.3s ease;
  }
  .task-item:hover { border-color: rgba(201,169,110,0.2); background: var(--surface2); }
  .task-check {
    width: 20px; height: 20px;
    border-radius: 6px;
    border: 2px solid var(--muted);
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.2s;
    flex-shrink: 0;
  }
  .task-check.done { background: var(--success); border-color: var(--success); }
  .task-text { flex: 1; font-size: 0.9rem; }
  .task-text.done { text-decoration: line-through; color: var(--muted); }
  .task-priority {
    font-size: 0.75rem;
    padding: 2px 8px;
    border-radius: 20px;
    font-weight: 500;
  }
  .priority-high { background: rgba(224,112,112,0.15); color: var(--danger); }
  .priority-med { background: rgba(201,169,110,0.15); color: var(--accent); }
  .priority-low { background: rgba(126,184,201,0.15); color: var(--accent2); }
  .task-del {
    background: none; border: none; color: var(--muted);
    cursor: pointer; font-size: 1rem; padding: 4px;
    transition: color 0.2s;
  }
  .task-del:hover { color: var(--danger); }

  /* ADD FORM */
  .add-form {
    background: var(--surface);
    border: 1px solid rgba(201,169,110,0.3);
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 16px;
    display: none;
    animation: fadeIn 0.3s ease;
  }
  .add-form.visible { display: block; }
  .form-row { display: flex; gap: 10px; margin-bottom: 10px; }
  .form-input {
    flex: 1;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 10px 14px;
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-size: 0.9rem;
    outline: none;
  }
  .form-input:focus { border-color: rgba(201,169,110,0.5); }
  .form-select {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 10px 14px;
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-size: 0.9rem;
    outline: none;
  }
  .form-actions { display: flex; gap: 8px; justify-content: flex-end; }
  .btn-cancel { padding: 8px 14px; background: transparent; border: 1px solid var(--border); color: var(--muted); border-radius: 8px; cursor: pointer; font-family: 'DM Sans',sans-serif; font-size:0.85rem; }
  .btn-save { padding: 8px 14px; background: linear-gradient(135deg, var(--accent), #a07840); border: none; color: #0d0f14; border-radius: 8px; cursor: pointer; font-family: 'DM Sans',sans-serif; font-size:0.85rem; font-weight: 500; }

  /* AGENDA PANEL */
  .agenda-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 4px;
    margin-bottom: 20px;
  }
  .day-header { text-align: center; font-size: 0.75rem; color: var(--muted); padding: 6px; }
  .day-cell {
    aspect-ratio: 1;
    display: flex; align-items: center; justify-content: center;
    border-radius: 8px;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.15s;
    position: relative;
  }
  .day-cell:hover { background: var(--surface2); }
  .day-cell.today { background: rgba(201,169,110,0.2); color: var(--accent); font-weight: 600; }
  .day-cell.has-event::after {
    content: '';
    position: absolute;
    bottom: 4px; left: 50%; transform: translateX(-50%);
    width: 4px; height: 4px;
    border-radius: 50%;
    background: var(--accent2);
  }
  .day-cell.other-month { color: var(--muted); opacity: 0.4; }
  .month-nav {
    display: flex; align-items: center; justify-content: space-between;
    margin-bottom: 16px;
  }
  .month-nav button { background: none; border: none; color: var(--muted); font-size: 1.2rem; cursor: pointer; padding: 4px 8px; transition: color 0.2s; }
  .month-nav button:hover { color: var(--text); }
  .month-name { font-family: 'Playfair Display', serif; font-size: 1.1rem; }

  .event-item {
    display: flex; gap: 12px;
    padding: 12px 16px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-left: 3px solid var(--accent2);
    border-radius: 8px;
    margin-bottom: 8px;
    animation: fadeIn 0.3s ease;
  }
  .event-time { font-size: 0.8rem; color: var(--accent2); white-space: nowrap; font-weight: 500; min-width: 60px; }
  .event-title { font-size: 0.9rem; }

  /* EMPTY STATE */
  .empty { text-align: center; padding: 48px 24px; color: var(--muted); }
  .empty-icon { font-size: 2.5rem; margin-bottom: 12px; }
  .empty p { font-size: 0.9rem; }

  /* Suggestions */
  .suggestions {
    display: flex; flex-wrap: wrap; gap: 8px; padding: 12px 24px;
    border-top: 1px solid var(--border);
  }
  .suggestion-chip {
    padding: 6px 14px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 20px;
    font-size: 0.8rem;
    color: var(--muted);
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }
  .suggestion-chip:hover { border-color: rgba(201,169,110,0.4); color: var(--accent); }
</style>
</head>
<body>

<header>
  <div class="logo">ASHA <span>Votre Assistant Personnel</span></div>
  <div class="status-dot" title="En ligne"></div>
</header>

<div class="tabs">
  <button class="tab active" onclick="switchTab('chat')">
    <span class="tab-icon">üí¨</span> Discussion
  </button>
  <button class="tab" onclick="switchTab('tasks')">
    <span class="tab-icon">‚úÖ</span> T√¢ches
  </button>
  <button class="tab" onclick="switchTab('agenda')">
    <span class="tab-icon">üìÖ</span> Agenda
  </button>
</div>

<!-- CHAT PANEL -->
<div class="panel active" id="panel-chat">
  <div class="chat-messages" id="chatMessages">
    <div class="message asha">
      <div class="avatar asha">‚ú¶</div>
      <div class="bubble">
        <div class="name">ASHA</div>
        Bonjour ! Je suis ASHA, votre assistant personnel. Je peux vous aider √† r√©pondre √† vos questions, g√©rer vos t√¢ches, organiser votre agenda et vous donner des conseils du quotidien. Comment puis-je vous aider aujourd'hui ?
      </div>
    </div>
  </div>
  <div class="suggestions" id="suggestions">
    <span class="suggestion-chip" onclick="sendSuggestion(this)">Quelles sont mes t√¢ches ?</span>
    <span class="suggestion-chip" onclick="sendSuggestion(this)">Donne-moi un conseil pour aujourd'hui</span>
    <span class="suggestion-chip" onclick="sendSuggestion(this)">Aide-moi √† m'organiser</span>
    <span class="suggestion-chip" onclick="sendSuggestion(this)">Quel temps fera-t-il ?</span>
  </div>
  <div class="chat-input-area">
    <div class="chat-input-row">
      <textarea class="chat-input" id="chatInput" placeholder="√âcrivez votre message..." rows="1" onkeydown="handleKey(event)" oninput="autoResize(this)"></textarea>
      <button class="send-btn" id="sendBtn" onclick="sendMessage()">‚û§</button>
    </div>
  </div>
</div>

<!-- TASKS PANEL -->
<div class="panel" id="panel-tasks">
  <div class="panel-content">
    <div class="panel-header">
      <h2 class="panel-title">Mes T√¢ches</h2>
      <button class="add-btn" onclick="toggleAddTask()">+ Ajouter</button>
    </div>
    <div class="add-form" id="addTaskForm">
      <div class="form-row">
        <input class="form-input" id="taskInput" placeholder="Nom de la t√¢che..." />
        <select class="form-select" id="taskPriority">
          <option value="low">üîµ Faible</option>
          <option value="med" selected>üü° Moyenne</option>
          <option value="high">üî¥ Haute</option>
        </select>
      </div>
      <div class="form-actions">
        <button class="btn-cancel" onclick="toggleAddTask()">Annuler</button>
        <button class="btn-save" onclick="addTask()">Enregistrer</button>
      </div>
    </div>
    <div id="taskList"></div>
  </div>
</div>

<!-- AGENDA PANEL -->
<div class="panel" id="panel-agenda">
  <div class="panel-content">
    <div class="panel-header">
      <h2 class="panel-title">Mon Agenda</h2>
      <button class="add-btn" onclick="toggleAddEvent()">+ √âv√©nement</button>
    </div>
    <div class="add-form" id="addEventForm">
      <div class="form-row">
        <input class="form-input" id="eventTitle" placeholder="Titre de l'√©v√©nement..." />
        <input class="form-input" type="date" id="eventDate" style="max-width:160px" />
        <input class="form-input" type="time" id="eventTime" style="max-width:110px" />
      </div>
      <div class="form-actions">
        <button class="btn-cancel" onclick="toggleAddEvent()">Annuler</button>
        <button class="btn-save" onclick="addEvent()">Enregistrer</button>
      </div>
    </div>
    <div class="month-nav">
      <button onclick="changeMonth(-1)">‚Äπ</button>
      <span class="month-name" id="monthName"></span>
      <button onclick="changeMonth(1)">‚Ä∫</button>
    </div>
    <div class="agenda-grid" id="calendarGrid"></div>
    <div id="eventList"></div>
  </div>
</div>

<script>
// ===== STATE =====
let tasks = [
  { id:1, text:'Faire les courses', done:false, priority:'high' },
  { id:2, text:'Lire un livre ce soir', done:false, priority:'low' },
];
let events = [
  { id:1, title:'R√©union √©quipe', date: new Date().toISOString().split('T')[0], time:'09:00' },
];
let currentMonth = new Date();
let conversationHistory = [];

// ===== TABS =====
function switchTab(tab) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  event.currentTarget.classList.add('active');
  document.getElementById('panel-' + tab).classList.add('active');
  if (tab === 'tasks') renderTasks();
  if (tab === 'agenda') renderCalendar();
}

// ===== CHAT =====
function autoResize(el) {
  el.style.height = 'auto';
  el.style.height = Math.min(el.scrollHeight, 120) + 'px';
}

function handleKey(e) {
  if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
}

function sendSuggestion(el) {
  document.getElementById('chatInput').value = el.textContent;
  sendMessage();
}

function appendMessage(role, text) {
  const msgs = document.getElementById('chatMessages');
  const div = document.createElement('div');
  div.className = 'message ' + role;
  div.innerHTML = role === 'asha'
    ? `<div class="avatar asha">‚ú¶</div><div class="bubble"><div class="name">ASHA</div>${text}</div>`
    : `<div class="avatar user">üë§</div><div class="bubble"><div class="name">Vous</div>${text}</div>`;
  msgs.appendChild(div);
  msgs.scrollTop = msgs.scrollHeight;
}

function showTyping() {
  const msgs = document.getElementById('chatMessages');
  const div = document.createElement('div');
  div.className = 'message asha'; div.id = 'typing';
  div.innerHTML = `<div class="avatar asha">‚ú¶</div><div class="bubble"><div class="typing"><span></span><span></span><span></span></div></div>`;
  msgs.appendChild(div);
  msgs.scrollTop = msgs.scrollHeight;
}

function removeTyping() {
  const t = document.getElementById('typing');
  if (t) t.remove();
}

async function sendMessage() {
  const input = document.getElementById('chatInput');
  const btn = document.getElementById('sendBtn');
  const text = input.value.trim();
  if (!text) return;

  appendMessage('user', text);
  input.value = ''; input.style.height = 'auto';
  btn.disabled = true;
  showTyping();

  const taskSummary = tasks.map(t => `- ${t.text} (${t.done?'fait':'√† faire'}, priorit√©: ${t.priority})`).join('\n') || 'Aucune t√¢che';
  const eventSummary = events.map(e => `- ${e.title} le ${e.date} √† ${e.time}`).join('\n') || 'Aucun √©v√©nement';

  conversationHistory.push({ role: 'user', content: text });

  const systemPrompt = `Tu es ASHA, un assistant personnel intelligent, chaleureux et efficace qui parle UNIQUEMENT en fran√ßais.
Tu aides l'utilisateur dans sa vie quotidienne : r√©pondre √† ses questions, g√©rer ses t√¢ches, organiser son agenda, et donner des conseils pratiques.

Contexte actuel de l'utilisateur :
T√ÇCHES :
${taskSummary}

√âV√âNEMENTS :
${eventSummary}

Date et heure actuelles : ${new Date().toLocaleString('fr-FR')}

Instructions :
- R√©ponds toujours en fran√ßais, de mani√®re concise et utile
- Sois chaleureux, professionnel et encourageant
- Si l'utilisateur parle de ses t√¢ches ou de son agenda, utilise le contexte ci-dessus
- Donne des conseils pratiques adapt√©s √† la vie quotidienne
- Formule des r√©ponses courtes (2-4 phrases maximum sauf si une explication d√©taill√©e est demand√©e)`;

  try {
    const response = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 1000,
        system: systemPrompt,
        messages: conversationHistory
      })
    });
    const data = await response.json();
    const reply = data.content?.[0]?.text || 'D√©sol√©, je n\'ai pas pu r√©pondre.';
    conversationHistory.push({ role: 'assistant', content: reply });
    removeTyping();
    appendMessage('asha', reply);
  } catch(e) {
    removeTyping();
    appendMessage('asha', 'Je rencontre une difficult√© de connexion. Veuillez r√©essayer.');
  }
  btn.disabled = false;
}

// ===== TASKS =====
function renderTasks() {
  const list = document.getElementById('taskList');
  if (!tasks.length) {
    list.innerHTML = `<div class="empty"><div class="empty-icon">üìã</div><p>Aucune t√¢che pour l'instant.<br>Ajoutez votre premi√®re t√¢che !</p></div>`;
    return;
  }
  list.innerHTML = tasks.map(t => `
    <div class="task-item">
      <div class="task-check ${t.done?'done':''}" onclick="toggleTask(${t.id})">${t.done?'‚úì':''}</div>
      <span class="task-text ${t.done?'done':''}">${t.text}</span>
      <span class="task-priority priority-${t.priority}">${{high:'Haute',med:'Moyenne',low:'Faible'}[t.priority]}</span>
      <button class="task-del" onclick="deleteTask(${t.id})">‚úï</button>
    </div>
  `).join('');
}

function toggleAddTask() {
  const form = document.getElementById('addTaskForm');
  form.classList.toggle('visible');
  if (form.classList.contains('visible')) document.getElementById('taskInput').focus();
}

function addTask() {
  const text = document.getElementById('taskInput').value.trim();
  if (!text) return;
  tasks.push({ id: Date.now(), text, done: false, priority: document.getElementById('taskPriority').value });
  document.getElementById('taskInput').value = '';
  toggleAddTask();
  renderTasks();
}

function toggleTask(id) {
  tasks = tasks.map(t => t.id === id ? {...t, done: !t.done} : t);
  renderTasks();
}

function deleteTask(id) {
  tasks = tasks.filter(t => t.id !== id);
  renderTasks();
}

// ===== AGENDA =====
const MONTHS = ['Janvier','F√©vrier','Mars','Avril','Mai','Juin','Juillet','Ao√ªt','Septembre','Octobre','Novembre','D√©cembre'];
const DAYS = ['Lun','Mar','Mer','Jeu','Ven','Sam','Dim'];

function renderCalendar() {
  const year = currentMonth.getFullYear();
  const month = currentMonth.getMonth();
  document.getElementById('monthName').textContent = `${MONTHS[month]} ${year}`;

  const grid = document.getElementById('calendarGrid');
  let html = DAYS.map(d => `<div class="day-header">${d}</div>`).join('');

  const first = new Date(year, month, 1);
  let startDay = first.getDay(); // 0=Sun
  startDay = startDay === 0 ? 6 : startDay - 1; // convert to Mon=0

  const today = new Date();
  const daysInMonth = new Date(year, month+1, 0).getDate();
  const daysInPrev = new Date(year, month, 0).getDate();

  for (let i = 0; i < startDay; i++) {
    const d = daysInPrev - startDay + 1 + i;
    html += `<div class="day-cell other-month">${d}</div>`;
  }

  const eventDates = new Set(events.map(e => e.date));

  for (let d = 1; d <= daysInMonth; d++) {
    const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const isToday = today.getDate()===d && today.getMonth()===month && today.getFullYear()===year;
    const hasEvent = eventDates.has(dateStr);
    html += `<div class="day-cell ${isToday?'today':''} ${hasEvent?'has-event':''}" onclick="filterEvents('${dateStr}')">${d}</div>`;
  }

  const remaining = 42 - startDay - daysInMonth;
  for (let i = 1; i <= remaining; i++) {
    html += `<div class="day-cell other-month">${i}</div>`;
  }

  grid.innerHTML = html;
  renderEvents();
}

function renderEvents(filterDate = null) {
  const list = document.getElementById('eventList');
  let shown = events;
  if (filterDate) shown = events.filter(e => e.date === filterDate);
  else {
    const year = currentMonth.getFullYear();
    const month = String(currentMonth.getMonth()+1).padStart(2,'0');
    shown = events.filter(e => e.date.startsWith(`${year}-${month}`));
  }
  shown.sort((a,b) => (a.date+a.time).localeCompare(b.date+b.time));
  if (!shown.length) {
    list.innerHTML = `<div class="empty"><div class="empty-icon">üìÖ</div><p>Aucun √©v√©nement ce mois-ci.</p></div>`;
    return;
  }
  list.innerHTML = shown.map(e => `
    <div class="event-item">
      <div class="event-time">${e.time}</div>
      <div>
        <div class="event-title">${e.title}</div>
        <div style="font-size:0.75rem;color:var(--muted);margin-top:2px">${new Date(e.date+'T00:00').toLocaleDateString('fr-FR',{weekday:'long',day:'numeric',month:'long'})}</div>
      </div>
    </div>
  `).join('');
}

function filterEvents(date) { renderEvents(date); }

function changeMonth(dir) {
  currentMonth.setMonth(currentMonth.getMonth() + dir);
  renderCalendar();
}

function toggleAddEvent() {
  const form = document.getElementById('addEventForm');
  form.classList.toggle('visible');
  if (form.classList.contains('visible')) {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('eventDate').value = today;
    document.getElementById('eventTitle').focus();
  }
}

function addEvent() {
  const title = document.getElementById('eventTitle').value.trim();
  const date = document.getElementById('eventDate').value;
  const time = document.getElementById('eventTime').value || '00:00';
  if (!title || !date) return;
  events.push({ id: Date.now(), title, date, time });
  document.getElementById('eventTitle').value = '';
  document.getElementById('eventTime').value = '';
  toggleAddEvent();
  renderCalendar();
}

// Init
renderTasks();
renderCalendar();
</script>
</body>
</html>
